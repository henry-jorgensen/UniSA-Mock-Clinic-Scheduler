@{
    ViewData["Title"] = "Clinics";
    ViewData["Controller"] = "Home";
	string currentUser = ViewBag.currentUser;
    List<AppointmentModel> appointments = ViewBag.Appointments;
}

<script src="~/js/moment.min.js"></script>
<link rel="stylesheet" type="text/css" href="/css/clinics.css">

<div class="container">
	<main role="main" class="pb-3">
		<h1>Upcoming Clinics</h1>

		<div class="col-sm-12" style="min-width: 200px;">
			<table class="table">
				<thead>
					<tr>
						<th>Date</th>
						<th>Location</th>
						<th>Patient</th>
						<th>Infectious</th>
						<th>Radiation Therapists</th>
						<th>Site</th>
						<th>Complication</th>
						<th>Treatment</th>
					</tr>
				</thead>

				<tbody>
					@foreach (var appointment in appointments)
					{
						var tempInfect = appointment.Infectious.Split(':');

						<tr>
							<td>
								<h6 class="mb-0">@appointment.Time</h6>
								<small>@appointment.Date</small>
							</td>

							<td>
								<h6 class="mb-0">@appointment.Room</h6>
							</td>

							<td>
								<h6 class="mb-0">@appointment.Patient</h6>
							</td>

							<td>
								<h6 class="mb-0 infectionColumn" value="@tempInfect[1]">@tempInfect[0]</h6>
							</td>

							<td>
								<p class="mb-0">@appointment.RadiationTherapist1</p>
								<p class="mb-0">@appointment.RadiationTherapist2</p>
							</td>

							<td>
								<h6 class="mb-0">@appointment.Site</h6>
							</td>	

							<td>
								@if (@appointment.Patient.Equals(currentUser))
								{
									<h6 class="mb-0">@appointment.Complication</h6>
								}
								else {
									<h6 class="mb-0">Hidden</h6>
								}
								
							</td>	

							<td>
								@if (@appointment.Patient.Equals(currentUser))
								{
									<h6 class="mb-0">Hidden</h6>
								}
								else {
									@Html.ActionLink("Treatment", "Treatment", "Home",
									new {
										date = @appointment.Date,
										time = @appointment.Time,
										room = @appointment.Room,
										patient = @appointment.Patient,
										infectious = @appointment.Infectious,
										rt1 = @appointment.RadiationTherapist1,
										rt2 = @appointment.RadiationTherapist2,
										site = @appointment.Site,
										complication = @appointment.Complication,
										ID = @appointment.AppointmentID
									},
									new { @class="btn button" }
									)
								}
							</td>
						</tr>
					}
				</tbody>
			</table>
		</div>
	</main>

	<!-- The Modal -->
    <div id="infectionModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
            <div>
                <h2 style="float:left;">WARNING</h2>
                <span id="closeButton" class="close">&times;</span>
            </div>
            <br />
            <div class="form-group">
                <div class="form-row">
                    <div class="col-md-6 mb-3">
                        <label for="modalInfectionTitle">Infection</label>
                        <input disabled type="text" class="form-control input" id="modalInfectionTitle" placeholder="COVID-19.." required>
                    </div>
                </div>      
                <div class="form-row mb-3">
                    <label for="modalinfectionDetails">Infection Details</label>
                    <textarea disabled class="form-control" id="modalinfectionDetails" rows="3" placeholder="Infection Details.."></textarea>
                </div> 
            </div>
        </div>
    </div>
</div>


<script>
	//setup on click listeners for the infection modal
    $(".infectionColumn").on('click', function(e){
        event.stopPropagation();
        event.stopImmediatePropagation();

		if (e.target.innerHTML == "False") {
            return
        }

        //Load the current values
        $("#modalInfectionTitle").val(e.target.innerHTML)
        $("#modalinfectionDetails").val(e.target.value);

        let modal = $("#infectionModal");
        let close = $("#closeButton");
        close.on('click', function () {
            modal.css("display", "none");
        });

        modal.css("display", "block");
    });	
</script>